const mainPageItems=document.querySelector(".swiper-wrapper"),catalogPageItems=document.querySelector(".products-catalog"),items=document.querySelector(".item-product"),checkbox=document.querySelector("#filters");function addEvent(t,e,a){return t.addEventListener?t.addEventListener(e,a,!1):t.attachEvent("on"+e,(function(){a.call(t)})),!1}async function getProducts(){let t=await fetch("json/products.json",{method:"GET"});if(t.ok){let e=await t.json();filter(e),loadProducts(e)}}function filter(t){catalogPageItems&&checkbox.addEventListener("input",(function(){const e=[...checkbox.querySelectorAll("#light input:checked")].map((t=>t.value)),a=[...checkbox.querySelectorAll("#color input:checked")].map((t=>t.value));loadProducts(t.filter((t=>(!e.length||e.includes(t.light))&&(!a.length||a.includes(t.color)))))}))}function deleteItems(){for(;catalogPageItems.firstChild;)catalogPageItems.removeChild(catalogPageItems.lastChild)}function loadProducts(t){let e;catalogPageItems&&deleteItems(),t.forEach((t=>{const a=t.id,r=t.url,i=t.image,o=t.title,n=t.price,c=t.priceOld,l=t.labels;mainPageItems?e=`<div data-id="${a}" class="swiper-slide">`:catalogPageItems&&(e=`<div data-id="${a}" class="item-product">`);let s="";if(l){let t='<div class="item-product__labels">',e="</div>",a="";l.forEach((t=>{a+=`<div class="item-product__label item-product__label_${t.type}">${t.value}</div>`})),s+=t,s+=a,s+=e}let d="";d='<div class="item-product__prices">',d+=`<div class="item-product__price">Rp ${n}</div>`,c&&(d+=`<del class="item-product__price item-product__oldPrice">Rp ${c}</del>`),d+="</div>";let u="";u+=e,u+=` <a href="${r}" class="item-product__image">\n\t\t<img id="image" src="${i}" alt="${o}"></a>\n\t\t`,u+=`\n\t\t<p class="item-product__title">${o}</p>\n\t\t<p class="item-product__price">${n}</p>\n\t\t`,u+=d,u+='\n\t\t\n\t\t\t<button class="button-cart addToCart">В корзину</button>\n\t\t\n\t\t',u+="</div>",mainPageItems?mainPageItems.insertAdjacentHTML("beforeend",u):catalogPageItems&&catalogPageItems.insertAdjacentHTML("beforeend",u)})),addToCart()}const cart=document.querySelector(".cart__items");function openCart(){let t=getCartData(),e="";if(null!==t){for(var a in t){let r=t[a][0],i=t[a][1],o=t[a][2],n=t[a][3],c=t[a][4];e+='<div class="cart__item item">',e+=`<div class="item__id">${r}</div>`,e+=`<div class="item__img">${i}</div>`,e+=`<div class="item__title">${o}</div>`,e+=`<div class="item__price">${n} ₽</div>`,e+='<div class="upDownContainer">',e+=c<=1?`<input item-id =  ${r}    id='down' class= 'down-button' type='button' value='-' data-changer='2' disabled>`:`<input item-id =  ${r}    id='down' class= 'down-button' type='button' value='-' data-changer='2'>`,e+=`<div class="item__count">${c}</div>`,e+=`<input item-id =  ${r}    class='up-button' id='up' type='button' value='+' data-changer='1'>`,e+="</div>",e+=`<input item-id = ${r} type="button" value='удалить' class="delete-button">`,e+="</div>",e+='<hr class= "cart__hr">'}cart.innerHTML=e}else cart.innerHTML="В корзине пусто!"}function setCartData(t){localStorage.setItem("cart",JSON.stringify(t))}function getCartData(){return JSON.parse(localStorage.getItem("cart"))}addToCart=function(){if(catalogPageItems)var t=document.querySelectorAll(".item-product");else if(mainPageItems)t=document.querySelectorAll(".swiper-slide");for(let e=0;e<t.length;e++)addEvent(t[e].querySelector(".addToCart"),"click",(function(){let a=getCartData()||{},r=t[e].getAttribute("data-id"),i=t[e].querySelector(".item-product__title").innerHTML,o=t[e].querySelector(".item-product__price").innerHTML,n=t[e].querySelector("#image").getAttribute("src");n=`<img class="cart__image" src="${n}">`,a.hasOwnProperty(r)?a[r][4]+=1:a[r]=[r,n,i,o,1],setCartData(a),openCart()}))},addEvent(cart,"click",(function(t){if("up-button"===t.target.className){let e=t.target.getAttribute("item-id"),a=getCartData();a[e][4]+=1,setCartData(a),openCart()}else if("down-button"===t.target.className){let e=t.target.getAttribute("item-id"),a=getCartData();a[e][4]-=1,setCartData(a),openCart()}else if("delete-button"===t.target.className){let e=t.target.getAttribute("item-id"),a=getCartData();delete a[e],setCartData(a),openCart()}}));const buttonOpenCart=document.querySelector("#buttonOpenCart"),buttonCloseCart=document.querySelector("#buttonCloseCart"),cartPage=document.querySelector(".cart"),wrapper=document.querySelector(".wrapper");function testWebP(t){var e=new Image;e.onload=e.onerror=function(){t(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}buttonOpenCart.onclick=function(){cartPage.classList.add("_opened"),wrapper.classList.add("_matteEffect"),openCart()},buttonCloseCart.onclick=function(){cartPage.classList.remove("_opened"),wrapper.classList.remove("_matteEffect")},testWebP((function(t){!0===t?document.querySelector("html").classList.add("_webp"):document.querySelector("html").classList.add("_no-webp")}));const burger=document.querySelector(".burger"),nav=document.querySelector(".header__list"),burgerContainer=document.querySelector(".burgerContainer");burger.onclick=function(){burger.classList.toggle("_active"),nav.classList.toggle("_active"),document.body.classList.toggle("_lock"),burgerContainer.classList.toggle("burgerContainer--right")},window.onload=function(){getProducts(),window.outerWidth>=windowTrigger&&mainPageItems&&(swiperInit(),setTimeout((function(){swiper.update(swiper)}),500))};let swiper=null,windowTrigger=768,swiperContainer=document.querySelector(".swiper-container"),url=window.location.href,clean_url=url.replace(/(\\|\/)/g,"");if(mainPageItems){function swiperInit(){swiper||(swiper=new Swiper(".swiper-container",{slidesPerView:3,loop:!0,direction:"horizontal",spaceBetween:50,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},scrollbar:{el:".swiper-scrollbar"}}))}function swiperDestroy(){swiper&&(swiper.destroy(),swiper=null)}onresize=function(){window.innerWidth>=windowTrigger?swiperInit():swiperDestroy()}}